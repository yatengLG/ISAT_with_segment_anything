# ISAT_with_segment_anything 打包为EXE说明文档

## 方法一：一键打包（推荐-最简单）

### 步骤：

1. **打开命令行**，进入项目目录：
   ```cmd
   cd Y:\字符区识别AI模型\字符标注-完\ISAT_with_segment_anything
   ```

2. **运行打包脚本**：
   ```cmd
   build_exe.bat
   ```

3. **等待完成**（约5-15分钟，取决于电脑性能）

4. **完成后**，可执行文件位于：`dist\ISAT_SAM\ISAT_SAM.exe`

### 注意事项：
- 整个 `dist\ISAT_SAM` 文件夹都必须保留，不要只复制exe文件
- 首次运行可能较慢
- 如果遇到错误，在命令行运行exe查看详细错误信息

---

## 方法二：使用Auto-py-to-exe（GUI界面-更直观）

### 步骤：

1. **安装auto-py-to-exe**：
   ```cmd
   pip install auto-py-to-exe
   ```

2. **启动GUI**：
   ```cmd
   auto-py-to-exe
   ```

3. **在GUI中配置**：
   - **Script Location**: 选择 `main.py`
   - **Onefile**: 选择 "One Directory"
   - **Console Window**: 选择 "Window Based (hide the console)"
   - **Icon**: 选择 `icons/M_Favicon.ico`

4. **添加额外文件**（点击 "Additional Files"）：
   - 添加 `icons` 文件夹 → `icons`
   - 添加 `ISAT/isat.yaml` → `ISAT`
   - 添加 `ISAT/software.yaml` → `ISAT`

5. **高级选项**（点击 "Advanced"）：
   - Hidden Imports: 添加以下内容（每行一个）：
     ```
     ISAT
     ISAT.main
     ISAT.annotation
     PyQt5
     torch
     torchvision
     timm
     cv2
     PIL
     ```

6. **点击 "CONVERT .PY TO .EXE"** 开始打包

7. **完成后**，输出文件在 `output` 文件夹中

---

## 方法三：手动使用PyInstaller（适合高级用户）

### 基础命令：

```cmd
pyinstaller --onedir --windowed --icon=icons/M_Favicon.ico main.py
```

### 完整命令（推荐）：

```cmd
pyinstaller ^
  --name=ISAT_SAM ^
  --onedir ^
  --windowed ^
  --icon=icons/M_Favicon.ico ^
  --add-data="icons;icons" ^
  --add-data="ISAT/isat.yaml;ISAT" ^
  --add-data="ISAT/software.yaml;ISAT" ^
  --collect-all ISAT ^
  --collect-all PyQt5 ^
  --collect-all torch ^
  --collect-all torchvision ^
  --hidden-import=ISAT.main ^
  --hidden-import=ISAT.annotation ^
  --hidden-import=PIL._tkinter_finder ^
  main.py
```

### 使用spec文件（更灵活）：

```cmd
pyinstaller build_exe.spec --clean
```

---

## 方法四：使用官方预编译版本（无需打包）

如果只是想使用该工具而不需要修改源码，可以直接：

1. 访问 [GitHub Releases](https://github.com/yatengLG/ISAT_with_segment_anything/releases)
2. 下载最新的预编译exe版本
3. 解压后直接运行 `main.exe`

---

## 常见问题解决

### 问题1：打包失败，提示找不到某个模块

**解决方案**：
1. 确认该模块已安装：`pip list | findstr 模块名`
2. 如果已安装但仍失败，在spec文件的 `hiddenimports` 列表中添加该模块

### 问题2：exe运行时报错

**解决方案**：
1. 在命令行运行exe查看详细错误：
   ```cmd
   cd dist\ISAT_SAM
   ISAT_SAM.exe
   ```
2. 根据错误信息添加缺失的数据文件或隐藏导入

### 问题3：exe文件过大

**原因**：包含了PyTorch等大型库

**优化方案**：
1. 使用CPU版本的PyTorch（如果不需要GPU）
2. 排除不需要的模块（在spec文件的 `excludes` 中添加）
3. 使用UPX压缩（可能导致兼容性问题）

### 问题4：杀毒软件报毒

**原因**：PyInstaller打包的exe容易被误报

**解决方案**：
1. 添加到杀毒软件白名单
2. 使用代码签名证书对exe进行签名
3. 向杀毒软件厂商提交误报申诉

### 问题5：在其他电脑无法运行

**可能原因**：
1. 缺少Visual C++运行库
2. Windows版本不兼容
3. 缺少必要的系统dll

**解决方案**：
1. 安装 [Visual C++ Redistributable](https://aka.ms/vs/17/release/vc_redist.x64.exe)
2. 使用 `--runtime-tmpdir` 参数指定临时目录
3. 在目标系统上测试并调试

---

## 打包参数说明

| 参数 | 说明 |
|------|------|
| `--onedir` | 生成一个文件夹（包含exe和依赖），推荐 |
| `--onefile` | 生成单个exe文件，但体积大且启动慢 |
| `--windowed` | GUI程序，不显示控制台窗口 |
| `--console` | 显示控制台窗口，便于调试 |
| `--icon` | 指定exe图标 |
| `--add-data` | 添加数据文件（格式：源;目标） |
| `--collect-all` | 收集指定包的所有文件 |
| `--hidden-import` | 添加隐藏导入的模块 |
| `--exclude-module` | 排除不需要的模块 |
| `--clean` | 清理临时文件后重新打包 |
| `--upx-dir` | 指定UPX压缩工具路径 |
| `--runtime-tmpdir` | 指定运行时临时目录 |

---

## 打包后的文件结构

```
dist/
└── ISAT_SAM/
    ├── ISAT_SAM.exe          # 主程序
    ├── _internal/            # 依赖文件（必需）
    │   ├── torch/
    │   ├── PyQt5/
    │   ├── ISAT/
    │   └── ...
    └── icons/                # 图标资源（如果添加）
```

---

## 分发说明

将整个 `dist\ISAT_SAM` 文件夹打包成zip文件即可分发给其他用户。

用户只需：
1. 解压zip文件
2. 双击 `ISAT_SAM.exe` 运行
3. 如提示缺少dll，安装 VC++运行库

---

## 技术支持

- **项目主页**: https://github.com/yatengLG/ISAT_with_segment_anything
- **文档**: https://isat-with-segment-anything.readthedocs.io/
- **问题反馈**: https://github.com/yatengLG/ISAT_with_segment_anything/issues

---

## 版本信息

- **Python**: >= 3.8
- **PyInstaller**: >= 5.0
- **主要依赖**:
  - PyQt5
  - torch >= 2.1.1
  - torchvision
  - timm
  - opencv-python-headless
  - 等（详见 requirements.txt）
