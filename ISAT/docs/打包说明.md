# ISAT 打包为EXE说明文档

## 方法一：软件内打包（推荐 - 最简单）

### 步骤：

1. **运行ISAT软件**
   - 从源码运行或使用已安装版本

2. **打开打包工具**
   - 点击菜单：`Tools → Build EXE`

3. **查看环境检查**
   - ✓ Python环境
   - ✓ PyInstaller（未安装会自动安装）
   - ✓ build_exe.spec配置文件

4. **开始打包**
   - 点击"开始打包 / Start Build"按钮
   - 等待5-15分钟（取决于电脑性能）
   - 实时查看打包日志

5. **完成**
   - 弹窗显示输出位置
   - 可执行文件位于：`dist\ISAT_SAM\ISAT_SAM.exe`

### 优势：
- ✅ 无需命令行知识
- ✅ 自动安装依赖
- ✅ 实时日志反馈
- ✅ 自动验证结果

### 注意事项：
- 整个 `dist\ISAT_SAM` 文件夹都必须保留
- 不要只复制exe文件
- 首次运行可能较慢

---

## 方法二：命令行打包（适合开发者）

如果软件内打包遇到问题，可以使用命令行：

### 使用spec文件：

```cmd
cd ISAT_with_segment_anything
pyinstaller build_exe.spec --clean
```

### 手动PyInstaller命令：

```cmd
pyinstaller ^
  --name=ISAT_SAM ^
  --onedir ^
  --windowed ^
  --icon=icons/M_Favicon.ico ^
  --add-data="icons;icons" ^
  --add-data="ISAT/isat.yaml;ISAT" ^
  --add-data="ISAT/software.yaml;ISAT" ^
  --collect-all ISAT ^
  --collect-all PyQt5 ^
  --collect-all torch ^
  --hidden-import=ISAT.main ^
  main.py
```

---

## 方法三：使用Auto-py-to-exe（GUI界面）

### 步骤：

1. **安装auto-py-to-exe**：
   ```cmd
   pip install auto-py-to-exe
   ```

2. **启动GUI**：
   ```cmd
   auto-py-to-exe
   ```

3. **在GUI中配置**：
   - **Script Location**: 选择 `main.py`
   - **Onefile**: 选择 "One Directory"
   - **Console Window**: 选择 "Window Based"
   - **Icon**: 选择 `icons/M_Favicon.ico`

4. **添加额外文件**：
   - 添加 `icons` 文件夹
   - 添加 `ISAT/isat.yaml`
   - 添加 `ISAT/software.yaml`

5. **点击 "CONVERT .PY TO .EXE"**

---

## 常见问题解决

### 问题1：软件内打包失败

**解决方案**：
1. 查看打包日志中的错误信息
2. 确保Python环境正常
3. 尝试使用方法二命令行打包
4. 检查build_exe.spec文件是否存在

### 问题2：PyInstaller安装失败

**解决方案**：
1. 手动安装：`pip install pyinstaller`
2. 使用国内镜像：`pip install pyinstaller -i https://pypi.tuna.tsinghua.edu.cn/simple`
3. 升级pip：`python -m pip install --upgrade pip`

### 问题3：exe运行时报错

**解决方案**：
1. 在命令行运行exe查看详细错误：
   ```cmd
   cd dist\ISAT_SAM
   ISAT_SAM.exe
   ```
2. 根据错误信息添加缺失的数据文件

### 问题4：exe文件过大

**原因**：包含了PyTorch等大型库

**说明**：
- 正常大小约为1-2GB（包含完整深度学习环境）
- 这是PyTorch应用的常见大小
- 可以使用CPU版PyTorch减小体积

### 问题5：杀毒软件报毒

**原因**：PyInstaller打包的exe容易被误报

**解决方案**：
1. 添加到杀毒软件白名单
2. 向杀毒软件厂商提交误报申诉
3. 使用代码签名证书签名

### 问题6：在其他电脑无法运行

**可能原因**：
1. 缺少Visual C++运行库
2. Windows版本不兼容

**解决方案**：
1. 安装 [Visual C++ Redistributable](https://aka.ms/vs/17/release/vc_redist.x64.exe)
2. 确保Windows 10或更高版本

---

## 打包后的文件结构

```
dist/
└── ISAT_SAM/
    ├── ISAT_SAM.exe          # 主程序
    ├── _internal/            # 依赖文件（必需）
    │   ├── torch/
    │   ├── PyQt5/
    │   ├── ISAT/
    │   │   ├── isat.yaml      # 类别配置（可修改）
    │   │   └── software.yaml  # 软件设置（可修改）
    │   └── ...
    └── icons/                # 图标资源
```

---

## 分发说明

### 打包分发：

1. 将整个 `dist\ISAT_SAM` 文件夹打包成zip
2. 分发给其他用户

### 用户使用：

1. 解压zip文件
2. 双击 `ISAT_SAM.exe` 运行
3. 如提示缺少dll，安装VC++运行库

### 配置文件修改：

打包后的配置文件位于 `_internal\ISAT\` 目录：
- `isat.yaml` - 类别配置
- `software.yaml` - 软件设置

修改后重启程序即可生效。

---

## PyInstaller参数说明

| 参数 | 说明 |
|------|------|
| `--onedir` | 生成一个文件夹（推荐） |
| `--onefile` | 生成单个exe（体积大、启动慢） |
| `--windowed` | GUI程序，不显示控制台 |
| `--console` | 显示控制台，便于调试 |
| `--icon` | 指定exe图标 |
| `--add-data` | 添加数据文件 |
| `--collect-all` | 收集包的所有文件 |
| `--hidden-import` | 添加隐藏导入 |
| `--clean` | 清理后重新打包 |

---

## 系统要求

### 打包环境：
- **Python**: >= 3.8
- **PyInstaller**: >= 5.0
- **操作系统**: Windows 10+

### 主要依赖：
- PyQt5
- torch >= 2.1.1
- torchvision
- timm
- opencv-python-headless

### 运行环境（分发后）：
- Windows 10 或更高版本
- Visual C++ Redistributable
- 约2GB磁盘空间

---

## 技术支持

- **项目主页**: https://github.com/gaoren002/ISAT_with_segment_anything
- **文档**: https://isat-with-segment-anything.readthedocs.io/
- **问题反馈**: https://github.com/gaoren002/ISAT_with_segment_anything/issues
